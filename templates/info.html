<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>home</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="author" content="shell">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.5.2.min.js"></script>
    <script>
    function readable_size(s){
	if (! s) {
	    return "--"
	}
	s = s / 1024 / 1024;
	return s.toFixed(0) + " MB"
    }
    $(document).ready(function(){
	p = $(location).attr('href').split('/');
	var name = p[p.length - 1];
	$.ajax({
	    url: '/info/' + name + '.json',
	    cache: false,
	    dataType: "json",
	    success: function(data){
		$("#info tbody").append("<tr><td>status</td><td>" + data['state'] + "</td></tr>");
		$("#info tbody").append("<tr><td>pid</td><td>" + data['pid'] + "</td></tr>");
		$("#info tbody").append("<tr><td>disk usage</td><td>" + data['diskusage'] + " MB</td></tr>");
		if (data['state'] == "RUNNING") {
		    $("#info tbody").append("<tr><td>cpu</td><td>" + data['cpu_usage'] + "</td></tr>");
		    $("#info tbody").append("<tr><td>user</td><td>" + data['user'] + "</td></tr>");
		    $("#info tbody").append("<tr><td>system</td><td>" + data['system'] + "</td></tr>");
		    $("#info tbody").append("<tr><td>memory</td><td>" + readable_size(data['memory']) + "</td></tr>");
		    $("#info tbody").append("<tr><td>cache</td><td>" + readable_size(data['cache']) + "</td></tr>");
		    $("#info tbody").append("<tr><td>rss</td><td>" + readable_size(data['rss']) + "</td></tr>");
		}		
	    },
	});
    });
    </script>
  </head>

  <body>
    <table>
      <tr>
	<td>
	  <table id="info">
	    <thead><tr><td>name</td><td>value</td></tr></thead>
	    <tbody></tbody>
	  </table>
	</td>
      </tr>
    </table>
  </body>
</html>
